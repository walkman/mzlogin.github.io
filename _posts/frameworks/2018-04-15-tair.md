---
layout: post
title: Tair 架构原理
categories: frameworks
description: Tair 架构原理解析
keywords: Tair
---

# Tair总体结构
Tair作为一个分布式系统，是由一个中心控制节点和一系列的服务节点组成。我们称中心控制节点为config server，服务节点是data server。
Config server负责管理所有的data server，维护data server的状态信息。
Data server对外提供各种数据服务，并以心跳的形式将自身状况汇报给config server。
Config server是控制节点，而且是单点，目前采用一主一备的形式来保证其可靠性。
所有的data server的地位都是等价的
![tair架构图](/images/posts/frameworks/tair1.png)

### 1 ConfigServer的功能
负责管理所有的data server, 维护data server的状态信息。
1. 通过维护和dataserver心跳来获知集群中存活节点的信息
2. 根据存活节点的信息来构建数据在集群中的分布表。
3. 提供数据分布表的查询服务。
4. 调度dataserver之间的数据迁移、复制。

### 2 DataServer的功能
对外提供各种数据服务, 并以心跳的形式将自身状况汇报给config server。
1. 提供存储引擎
2. 接受client的put/get/remove等操作
3. 执行数据迁移，复制等
4. 插件：在接受请求的时候处理一些自定义功能
5. 访问统计

### 3 InvalidServer的功能
1. 接收来自client的invalid/hide等请求后，对属于同一组的集群（双机房独立集群部署方式）做delete/hide操作，保证同一组集群的一致。
2. 集群断网之后的，脏数据清理。
3. 访问统计。

### 4 client的功能
1. 在应用端提供访问Tair集群的接口。
2. 更新并缓存数据分布表和invalidserver地址等。
3. LocalCache，避免过热数据访问影响tair集群服务。
4. 流控

# Tair的负载均衡
Tair的分布采用的是一致性哈希算法。对于所有的key，分配到Q个桶中，桶是负载均衡和数据迁移的基本单位。
Config server根据一定的策略把每个桶指派到不同的data server上。
因为数据按照key做hash算法，所以可以认为每个桶中的数据基本是平衡的，保证了桶分布的均衡性，就保证了数据分布的均衡性。